---
title: "simple"
output: rmarkdown::render
vignette: >
  %\VignetteIndexEntry{simple}
  %\VignetteEngine{rmarkdown::render}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE, echo=FALSE, }
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", cache = TRUE
)
```

```{r setup}
remotes::install_github(repo="trashbirdecology/bbsAssistant", ref="main", force=FALSE)
library(bbsAssistant)
library(dplyr)
```

```{r dataavail}
data(package="bbsAssistant")
```


```{r get_data}
message("This might take ~20 seconds, patience..")

## alternatively, locally download the data...
bbs_data <- get_bbs_data() # make take a hot minute if you haven't already downloaded the data....
df <- left_join(bbs_data$observations, bbs_data$routes)  # lazy but whatever
rm(bbs_data) # clear list, unless you want it still or need the weather or species
```

```{r takealook}
# glimpse(bbs_data$observations) # the most recent (unless otherwise specified) bbs observations
# glimpse(bbs_data$routes) # route data associated 
# glimpse(bbs_data$weather) # weather associated with route data
```

```{r summary}
# nrow(df[df$SpeciesTotal==0,])## ensuring this is presence-only data
nyears.per.spproute <- df %>% 
  group_by(CountryNum, StateNum, Route, AOU) %>% 
  summarise(nyears=n()) # number of years of observations per species per route (by country/state route id)
hist(nyears.per.spproute$nyears)

nyears.per.bcrstate <- df %>% 
  group_by(Stratum, CountryNum, StateNum, AOU) %>% 
  summarise(nyears=n()) # number of years of observations per species per stratum & state)
hist(nyears.per.bcrstate$nyears)
```


```{r }
nbirds.per.stratum <- df %>% 
  group_by(Stratum, AOU, Year) %>% 
  summarise(total.obs=sum(SpeciesTotal)) #total count of specices per stratum

hist(nbirds.per.stratum$total.obs)

max(nbirds.per.stratum$total.obs) ## this is probably right but make sure its a fkn duck or something
nbirds.per.stratum$AOU %>% unique() ## unique birds here
```

```{r }
nbirds.per.state <- df %>% 
  group_by(CountryNum, StateNum, AOU, Year) %>% 
  summarise(total.obs=sum(SpeciesTotal)) # 
nbirds.per.state$AOU %>% unique() ## unique birds here
```