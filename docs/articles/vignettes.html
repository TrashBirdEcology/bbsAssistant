<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>vignettes • bbsAssistant</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="vignettes">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bbsAssistant</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignettes.html">vignettes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>vignettes</h1>
            
      
      
      <div class="hidden name"><code>vignettes.Rmd</code></div>

    </div>

    
    
<div id="brief-overview-of-bbsassistant-functionality" class="section level1">
<h1 class="hasAnchor">
<a href="#brief-overview-of-bbsassistant-functionality" class="anchor"></a>Brief Overview of bbsAssistant Functionality</h1>
<div id="installing-package-and-loading-dependencies" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-package-and-loading-dependencies" class="anchor"></a>Installing package and loading dependencies</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># devtools::install_github("trashbirdecology/bbsAssistant", dependencies = TRUE, force=FALSE)</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(bbsAssistant)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(stringr)</a></code></pre></div>
</div>
<div id="downloading-the-bbs-data-from-usgs-ftp" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-the-bbs-data-from-usgs-ftp" class="anchor"></a>Downloading the BBS data from USGS FTP</h2>
<div id="define-andor-create-local-directories" class="section level3">
<h3 class="hasAnchor">
<a href="#define-andor-create-local-directories" class="anchor"></a>Define and/or create local directories</h3>
<p>This function will create, if it does not already exist, folder <strong>./bbsData/</strong> within which to locally store BBS data and results. <strong>NOTE</strong>: If the directory exists, it will not overwrite files. If the bbs data already exists inside bbsDir, then we will create a logical to NOT download the data (see below). If you wish to download more, or overwrite existing data, please specify downloadBBSData=TRUE or remove .zip files from <strong>/bbsData/</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Create a directory to store and/or load the BBS data as feathers</span></a>
<a class="sourceLine" id="cb2-2" title="2">bbsDir &lt;-<span class="st"> </span>here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">"bbsData/"</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files2">dir.create</a></span>(bbsDir)</a></code></pre></div>
</div>
<div id="retrieve-and-import-bbs-data" class="section level3">
<h3 class="hasAnchor">
<a href="#retrieve-and-import-bbs-data" class="anchor"></a>Retrieve and import BBS data</h3>
<p>If necessary, download all or some of the BBS state-level data. Note: Downloading all the data to file takes 10-15 minutes, so only run if you have not recently downloaded the BBS data.</p>
<p>Let’s focus on a single species and state for brevity:</p>
<p>First, let’s retrieve the regions of data that are available. The function <code>get_regions</code> retrieves the .zip filenames of all U.S. states and Canadian provinces, including their reference numbers and region codes.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># a. Load the regional .txt file from Patuxent's FTP server (you must be connected to the internet to perform this step)</span></a>
<a class="sourceLine" id="cb3-2" title="2">regions &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_regions.html">get_regions</a></span>()</a></code></pre></div>
<p>Let’s restrict our data download to <strong>Florida</strong> data:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">regionFileName &lt;-<span class="st"> </span>regions<span class="op">$</span>zipFileName <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>()</a>
<a class="sourceLine" id="cb4-2" title="2">(regionFileName.use &lt;-<span class="st"> </span>regionFileName[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(stringr<span class="op">::</span><span class="kw"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span>(regionFileName, <span class="st">"Flori"</span>)<span class="op">==</span><span class="ot">TRUE</span>)])</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt; [1] "Florida.zip"</span></a></code></pre></div>
<p>Once we have one or more region filenames, we can use function <code>get_bbsData</code> to download the .zip file to a temporary folder (unless otherwise specified), and <em>import</em> the temp file to R object. The R object, flBBS, contains the raw BBS count data.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># check to see whether the data we need is already on file. if not, download it.</span></a>
<a class="sourceLine" id="cb5-2" title="2">flBBS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_bbsData.html">get_bbsData</a></span>(<span class="dt">file=</span>regionFileName.use)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; [1] "Data were imported from the FTP server"</span></a></code></pre></div>
<p>Next, we can download the BBS route-level geographic information and metadata, and append this to the original data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">routes &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_routeInfo.html">get_routeInfo</a></span>() <span class="co"># retrieve route-level data</span></a>
<a class="sourceLine" id="cb6-2" title="2">flBBS &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(flBBS, routes) <span class="co"># merge route-level data to bird count data</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(flBBS <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(aou, year, route, statenum, countrynum, stoptotal, latitude, longitude))</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt; Observations: 139,735</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt; Variables: 8</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; $ aou        &lt;int&gt; 1840, 2000, 2010, 2890, 3100, 3131, 3160, 3390, 3430,…</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt; $ year       &lt;int&gt; 1967, 1967, 1967, 1967, 1967, 1967, 1967, 1967, 1967,…</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; $ route      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; $ statenum   &lt;int&gt; 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 2…</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt; $ countrynum &lt;int&gt; 840, 840, 840, 840, 840, 840, 840, 840, 840, 840, 840…</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">#&gt; $ stoptotal  &lt;dbl&gt; 3, 1, 1, 37, 1, 1, 7, 1, 1, 1, 1, 1, 2, 11, 5, 4, 2, …</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">#&gt; $ latitude   &lt;dbl&gt; 30.92918, 30.92918, 30.92918, 30.92918, 30.92918, 30.…</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">#&gt; $ longitude  &lt;dbl&gt; -87.40794, -87.40794, -87.40794, -87.40794, -87.40794…</span></a></code></pre></div>
<p>If we wish to save these data to file, we can do so by saving as **.feather*s, a compressed file formatted for use in R.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="../reference/export_bbsFeathers.html">export_bbsFeathers</a></span>(<span class="dt">dataIn =</span> flBBS,</a>
<a class="sourceLine" id="cb7-2" title="2">                <span class="dt">newDir  =</span> bbsDir,</a>
<a class="sourceLine" id="cb7-3" title="3">                <span class="dt">filename =</span> regionFileName.use)</a></code></pre></div>
</div>
</div>
<div id="import-bbs-data-from-file-into-r" class="section level2">
<h2 class="hasAnchor">
<a href="#import-bbs-data-from-file-into-r" class="anchor"></a>Import BBS data from file into R</h2>
<p>If the BBS data was downloaded previously and saved as .feather, we can import it using <code>import_bbsFeathers</code>. The code below is particularly useful if you are importing multiple files (e.g., multiple states)</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">(featherNames &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list.files">list.files</a></span>(bbsDir, <span class="dt">pattern =</span> <span class="st">".feather"</span>))</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#&gt; [1] "Florida.feather"</span></a>
<a class="sourceLine" id="cb8-3" title="3">featherNames &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span>(<span class="st">"/"</span>, featherNames) <span class="co">#add separator</span></a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5">feather &lt;-<span class="st"> </span><span class="kw"><a href="../reference/import_bbsFeathers.html">import_bbsFeathers</a></span>(<span class="dt">newDir  =</span> bbsDir,</a>
<a class="sourceLine" id="cb8-6" title="6">                              <span class="dt">filename =</span> featherNames)</a>
<a class="sourceLine" id="cb8-7" title="7"><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(feather) <span class="co"># Notice that the data imported from disk (feathers) differs from the original BBS data in that the # of columns is fewer (9 and 12 columns, respectively).</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">#&gt; Observations: 139,735</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co">#&gt; Variables: 9</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">#&gt; $ year       &lt;int&gt; 1967, 1967, 1967, 1967, 1967, 1967, 1967, 1967, 1967,…</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="co">#&gt; $ countrynum &lt;int&gt; 840, 840, 840, 840, 840, 840, 840, 840, 840, 840, 840…</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co">#&gt; $ statenum   &lt;int&gt; 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 2…</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="co">#&gt; $ route      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="co">#&gt; $ bcr        &lt;int&gt; 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 2…</span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="co">#&gt; $ latitude   &lt;dbl&gt; 30.92918, 30.92918, 30.92918, 30.92918, 30.92918, 30.…</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="co">#&gt; $ longitude  &lt;dbl&gt; -87.40794, -87.40794, -87.40794, -87.40794, -87.40794…</span></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="co">#&gt; $ aou        &lt;int&gt; 1840, 2000, 2010, 2890, 3100, 3131, 3160, 3390, 3430,…</span></a>
<a class="sourceLine" id="cb8-18" title="18"><span class="co">#&gt; $ stoptotal  &lt;dbl&gt; 3, 1, 1, 37, 1, 1, 7, 1, 1, 1, 1, 1, 2, 11, 5, 4, 2, …</span></a></code></pre></div>
<div id="option-for-downloading-all-bbs-data" class="section level3">
<h3 class="hasAnchor">
<a href="#option-for-downloading-all-bbs-data" class="anchor"></a>Option for downloading ALL BBS data</h3>
<p>If you wish to download and/or import ALL the data, you might choose to do so in a loop. Note: this is expensive! The following are not run in this example.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Throw a warning if files exist</span></a>
<a class="sourceLine" id="cb9-2" title="2">    <span class="cf">if</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list.files">list.files</a></span>(bbsDir, <span class="dt">pattern =</span> <span class="st">"*.feather"</span>)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ){</a>
<a class="sourceLine" id="cb9-3" title="3">        downloadBBSData =<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb9-4" title="4">    }<span class="cf">else</span>(</a>
<a class="sourceLine" id="cb9-5" title="5">        {<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files2">dir.create</a></span>(bbsDir)</a>
<a class="sourceLine" id="cb9-6" title="6">        downloadBBSData =<span class="st"> </span><span class="ot">TRUE</span>}</a>
<a class="sourceLine" id="cb9-7" title="7">        )</a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co">## Download ALL the regions of BBS data</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="cf">if</span>(downloadBBSData<span class="op">==</span><span class="ot">TRUE</span>){</a>
<a class="sourceLine" id="cb9-10" title="10"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(regionFileName)){</a>
<a class="sourceLine" id="cb9-11" title="11">        bbsData &lt;-<span class="st">  </span><span class="kw"><a href="../reference/import_bbsData.html">import_bbsData</a></span>(</a>
<a class="sourceLine" id="cb9-12" title="12">            <span class="co"># arguments for get_bbsData()</span></a>
<a class="sourceLine" id="cb9-13" title="13">            <span class="dt">file =</span> regionFileName[i],</a>
<a class="sourceLine" id="cb9-14" title="14">            <span class="dt">dir =</span>  <span class="st">"ftp://ftpext.usgs.gov/pub/er/md/laurel/BBS/DataFiles/States/"</span>,</a>
<a class="sourceLine" id="cb9-15" title="15">            <span class="dt">year =</span> <span class="ot">NULL</span>, <span class="co"># subset by year</span></a>
<a class="sourceLine" id="cb9-16" title="16">            <span class="dt">aou =</span> <span class="ot">NULL</span>, <span class="co"># subset by AOU #s</span></a>
<a class="sourceLine" id="cb9-17" title="17">            <span class="dt">countrynum =</span> <span class="ot">NULL</span>, <span class="co"># subset by country number</span></a>
<a class="sourceLine" id="cb9-18" title="18">            <span class="dt">states =</span> <span class="ot">NULL</span>, <span class="co"># subset by state/povince number</span></a>
<a class="sourceLine" id="cb9-19" title="19">            <span class="co">#  arguments for get_routeInfo():</span></a>
<a class="sourceLine" id="cb9-20" title="20">            <span class="dt">routesFile =</span> <span class="st">"routes.zip"</span>,</a>
<a class="sourceLine" id="cb9-21" title="21">            <span class="dt">routesDir =</span>  <span class="st">"ftp://ftpext.usgs.gov/pub/er/md/laurel/BBS/DataFiles/"</span>,</a>
<a class="sourceLine" id="cb9-22" title="22">            <span class="dt">RouteTypeID =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb9-23" title="23">            <span class="co"># one or more of c(1,2,3)</span></a>
<a class="sourceLine" id="cb9-24" title="24">            <span class="dt">Stratum =</span> <span class="ot">NULL</span>,  <span class="co"># subset by BBS stratum</span></a>
<a class="sourceLine" id="cb9-25" title="25">            <span class="dt">BCR =</span> <span class="ot">NULL</span> <span class="co"># subset by BCR (bird conservation region)</span></a>
<a class="sourceLine" id="cb9-26" title="26">        )</a>
<a class="sourceLine" id="cb9-27" title="27"><span class="co"># d. Save the unzipped files to disk.</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="kw"><a href="../reference/export_bbsFeathers.html">export_bbsFeathers</a></span>(<span class="dt">dataIn  =</span> bbsData,</a>
<a class="sourceLine" id="cb9-29" title="29">                <span class="dt">newDir  =</span> bbsDir,</a>
<a class="sourceLine" id="cb9-30" title="30">                <span class="dt">filename =</span> regionFileName[i])</a>
<a class="sourceLine" id="cb9-31" title="31"><span class="co"># e. Clear object from memory</span></a>
<a class="sourceLine" id="cb9-32" title="32"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(bbsData)</a>
<a class="sourceLine" id="cb9-33" title="33">} <span class="co"># end section I. loop</span></a>
<a class="sourceLine" id="cb9-34" title="34">}<span class="cf">else</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">message</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"NOT DOWNLOADING BBS DATA. If you wish to download the BBS data, please remove files from directory: "</span>,bbsDir))) <span class="co"># end if-else to download the data</span></a></code></pre></div>
<p>Use the same code as above to import <em>multiple</em> feathers from file:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">feathers &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb10-2" title="2">featherNames &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list.files">list.files</a></span>(bbsDir, <span class="dt">pattern =</span> <span class="st">".feather"</span>)</a>
<a class="sourceLine" id="cb10-3" title="3">featherNames &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span>(<span class="st">"/"</span>, featherNames) <span class="co">#add separator</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(featherNames)) {</a>
<a class="sourceLine" id="cb10-5" title="5">  feather &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb10-6" title="6">  feather &lt;-<span class="st"> </span><span class="kw"><a href="../reference/import_bbsFeathers.html">import_bbsFeathers</a></span>(<span class="dt">newDir  =</span> bbsDir,</a>
<a class="sourceLine" id="cb10-7" title="7">                              <span class="dt">filename =</span> featherNames[i]) </a>
<a class="sourceLine" id="cb10-8" title="8">  feathers &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(feathers, feather)</a>
<a class="sourceLine" id="cb10-9" title="9">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(feather)</a>
<a class="sourceLine" id="cb10-10" title="10"> </a>
<a class="sourceLine" id="cb10-11" title="11">}</a></code></pre></div>
</div>
</div>
<div id="subsetting-the-bbs-count-data" class="section level2">
<h2 class="hasAnchor">
<a href="#subsetting-the-bbs-count-data" class="anchor"></a>Subsetting the BBS count data</h2>
<div id="subset-bbs-data-by-taxonomic-groups" class="section level3">
<h3 class="hasAnchor">
<a href="#subset-bbs-data-by-taxonomic-groups" class="anchor"></a>Subset BBS data by taxonomic groups</h3>
<p>First, retrieve the species list from the BBS FTP server.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">spp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_speciesList.html">get_speciesList</a></span>()</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(spp) </a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">#&gt; Observations: 750</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&gt; Variables: 9</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&gt; $ seq              &lt;dbl&gt; 6, 7, 8, 9, 10, 11, 13, 18, 19, 21, 22, 23, 24,…</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt; $ aou              &lt;dbl&gt; 1770, 1780, 1760, 1690, 1691, 1700, 1710, 1730,…</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt; $ commonName       &lt;chr&gt; "Black-bellied Whistling-Duck", "Fulvous Whistl…</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&gt; $ frenchCommonName &lt;chr&gt; "Dendrocygne à ventre noir", "Dendrocygne fauve…</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt; $ scientificName   &lt;chr&gt; "Dendrocygna autumnalis", "Dendrocygna bicolor"…</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt; $ order            &lt;chr&gt; "Anseriformes", "Anseriformes", "Anseriformes",…</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="co">#&gt; $ family           &lt;chr&gt; "Anatidae", "Anatidae", "Anatidae", "Anatidae",…</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co">#&gt; $ genus            &lt;chr&gt; "Dendrocygna", "Dendrocygna", "Anser", "Anser",…</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co">#&gt; $ species          &lt;chr&gt; "autumnalis", "bicolor", "canagicus", "caerules…</span></a></code></pre></div>
<p>Subset by species AOU # (e.g. House Sparrow aou = 06882)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw"><a href="../reference/subset_speciesList.html">subset_speciesList</a></span>(<span class="dt">myData =</span> flBBS, <span class="dt">aou.ind =</span> <span class="dv">06882</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">#&gt; Observations: 138,393</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">#&gt; Variables: 23</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&gt; $ routedataid       &lt;int&gt; 6234830, 6234830, 6234830, 6234830, 6234830, 6…</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt; $ countrynum        &lt;int&gt; 840, 840, 840, 840, 840, 840, 840, 840, 840, 8…</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&gt; $ statenum          &lt;int&gt; 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25…</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&gt; $ route             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt; $ rpid              &lt;int&gt; 101, 101, 101, 101, 101, 101, 101, 101, 101, 1…</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; $ year              &lt;int&gt; 1967, 1967, 1967, 1967, 1967, 1967, 1967, 1967…</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; $ aou               &lt;int&gt; 1840, 2000, 2010, 2890, 3100, 3131, 3160, 3390…</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt; $ count10           &lt;dbl&gt; 0, 0, 0, 12, 1, 0, 3, 0, 0, 0, 0, 0, 0, 2, 2, …</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt; $ count20           &lt;dbl&gt; 0, 0, 0, 22, 0, 0, 2, 0, 0, 0, 0, 0, 1, 7, 0, …</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt; $ count30           &lt;dbl&gt; 1, 0, 0, 7, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0…</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt; $ count40           &lt;dbl&gt; 30, 3, 1, 7, 0, 1, 2, 1, 0, 0, 0, 1, 0, 6, 2, …</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt; $ count50           &lt;dbl&gt; 5, 0, 0, 12, 0, 0, 0, 0, 1, 0, 0, 0, 2, 5, 1, …</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&gt; $ stoptotal         &lt;dbl&gt; 3, 1, 1, 37, 1, 1, 7, 1, 1, 1, 1, 1, 2, 11, 5,…</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&gt; $ speciestotal      &lt;dbl&gt; 36, 3, 1, 60, 1, 1, 7, 1, 1, 1, 1, 1, 3, 20, 5…</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co">#&gt; $ routeID           &lt;chr&gt; "25 1", "25 1", "25 1", "25 1", "25 1", "25 1"…</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co">#&gt; $ routename         &lt;fct&gt; OAK GROVE, OAK GROVE, OAK GROVE, OAK GROVE, OA…</span></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="co">#&gt; $ active            &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span></a>
<a class="sourceLine" id="cb12-21" title="21"><span class="co">#&gt; $ latitude          &lt;dbl&gt; 30.92918, 30.92918, 30.92918, 30.92918, 30.929…</span></a>
<a class="sourceLine" id="cb12-22" title="22"><span class="co">#&gt; $ longitude         &lt;dbl&gt; -87.40794, -87.40794, -87.40794, -87.40794, -8…</span></a>
<a class="sourceLine" id="cb12-23" title="23"><span class="co">#&gt; $ stratum           &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4…</span></a>
<a class="sourceLine" id="cb12-24" title="24"><span class="co">#&gt; $ bcr               &lt;int&gt; 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27…</span></a>
<a class="sourceLine" id="cb12-25" title="25"><span class="co">#&gt; $ routetypeid       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></a>
<a class="sourceLine" id="cb12-26" title="26"><span class="co">#&gt; $ routetypedetailid &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></a></code></pre></div>
<p>We could merge the bbs count data with the species list to avoid having to refer to AOU, then just subset using species name (e.g. ’House Sparrow).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">flBBS &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(flBBS, spp)</a>
<a class="sourceLine" id="cb13-2" title="2">hospBBS &lt;-<span class="st"> </span>flBBS <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(commonName<span class="op">==</span><span class="st">"House Sparrow"</span>) </a></code></pre></div>
<p>We can also use the <code>subset_SpeciesList</code> as a convenient way to <strong>remove</strong> taxonomic groups from the BBS data.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">flBBS.subset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/subset_speciesList.html">subset_speciesList</a></span>(flBBS, <span class="dt">fam.ind =</span> <span class="st">"Passeridae"</span>) </a>
<a class="sourceLine" id="cb14-2" title="2">flBBS.subset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/subset_speciesList.html">subset_speciesList</a></span>(flBBS, <span class="dt">fam.ind =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Passeridae"</span>, <span class="st">"Parulidae"</span>)) <span class="co"># or remove multiple fams</span></a></code></pre></div>
</div>
</div>
<div id="retrieve-bbs-analysis-results-and-data-credibility-measures" class="section level2">
<h2 class="hasAnchor">
<a href="#retrieve-bbs-analysis-results-and-data-credibility-measures" class="anchor"></a>Retrieve BBS analysis results and data credibility measures</h2>
<p>There are a few options for obtaining species trends estimates and credibility measures: 1) download the entire region-species csvs for various analyses or 2) provide a URl to species- or region-specific estimates for the 1966-2015 trend estimates.</p>
<div id="option-1-download-csv-for-all-species-region-combinations" class="section level3">
<h3 class="hasAnchor">
<a href="#option-1-download-csv-for-all-species-region-combinations" class="anchor"></a>Option 1: Download CSV for all species-region combinations</h3>
<p>The function <code>get_analysis_results</code> allows you to specify an analysis type, and upload all species-regions combination estimates or annual indices to object. Let’s look at Florida House Sparrow trend estimates for Florida:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_analysis_results.html">get_analysis_results</a></span>(<span class="dt">analysis =</span> <span class="st">"trend.ests"</span>) <span class="co"># default here is to obtain the 1966-2015 species trend estimates</span></a>
<a class="sourceLine" id="cb15-2" title="2">results.flHOSP &lt;-<span class="st"> </span>results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Species.Name<span class="op">==</span><span class="st">"House Sparrow"</span>, Region.Code<span class="op">==</span><span class="st">"FLA"</span>)</a></code></pre></div>
<p>Get annual trend estimates for Florida 1966-2016 analysis:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_analysis_results.html">get_analysis_results</a></span>(<span class="dt">analysis =</span> <span class="st">"annual.inds.2016"</span>) <span class="co"># default here is to obtain the 1966-2015 species trend estimates. </span></a></code></pre></div>
<p><img src="vignettes_files/figure-html/plottrend-1.png" width="33%"></p>
</div>
<div id="options-2-retrieve-region-specific-estimates-using-web-scraping" class="section level3">
<h3 class="hasAnchor">
<a href="#options-2-retrieve-region-specific-estimates-using-web-scraping" class="anchor"></a>Options 2: Retrieve region-specific estimates using web-scraping</h3>
<p>Another useful feature of this package is the ability to retrieve data credibility and species trend estimates from the BBS results using the function <code>get_credibility_trends</code>. This function allows the user to input a url to the region- or species-specific results page (see instructions below), as opposed to using function <code>get_analysis_results</code>. As an example, we retrieve the credibility scores and species trend estimates for <strong>House Sparrows in Florida</strong>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">cred &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_credibility_trends.html">get_credibility_trends</a></span>() <span class="co"># default here is Florida House Sparrows.</span></a>
<a class="sourceLine" id="cb17-2" title="2"></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co"># credibility colors correspond with the color scheme used on the BBS results page</span></a>
<a class="sourceLine" id="cb17-4" title="4">cred <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(credibilityNumber, credibilityColor, credibilityClass)</a>
<a class="sourceLine" id="cb17-5" title="5"><span class="co">#&gt;   credibilityNumber credibilityColor     credibilityClass</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="co">#&gt; 1                 2              Red important_deficiency</span></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="co">#&gt; 2                 0             Blue        no_deficiency</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co">#&gt; 3                 1           Yellow           deficiency</span></a></code></pre></div>
<p>Trend estimates are also listed in <code>cred</code> for Florida House Sparrow data:</p>
<pre><code>#&gt; Observations: 0
#&gt; Variables: 12
#&gt; $ Species           &lt;chr&gt; 
#&gt; $ N                 &lt;dbl&gt; 
#&gt; $ Trend_1966_2015   &lt;dbl&gt; 
#&gt; $ CI_2.5_1966_2015  &lt;dbl&gt; 
#&gt; $ CI_97.5_1966_2015 &lt;dbl&gt; 
#&gt; $ Trend_2005_2015   &lt;dbl&gt; 
#&gt; $ CI_2.5_2005_2015  &lt;dbl&gt; 
#&gt; $ CI_97.5_2005_2015 &lt;dbl&gt; 
#&gt; $ RA                &lt;dbl&gt; 
#&gt; $ credibilityNumber &lt;chr&gt; 
#&gt; $ credibilityColor  &lt;fct&gt; 
#&gt; $ credibilityClass  &lt;fct&gt;</code></pre>
<div id="steps-for-obtaining-argument-url-in-function-get_credibility_trends" class="section level4">
<h4 class="hasAnchor">
<a href="#steps-for-obtaining-argument-url-in-function-get_credibility_trends" class="anchor"></a>Steps for obtaining argument “url” in function <code>get_credibility_trends</code>:</h4>
<p>First, visit the USGS Patuxent Wildlife Research Center’s <a href="https://www.mbr-pwrc.usgs.gov/">website for BBS results</a> Online <a href="https://www.mbr-pwrc.usgs.gov/" class="uri">https://www.mbr-pwrc.usgs.gov/</a>.</p>
<p>Next, enable the drop-down <strong>Survey Results</strong>, and choose <strong>Trend Estimates (by region)</strong> (left) and choose the desired region (e.g. Florida). Finally, copy the URL address for the page including the results and credibility measures (e.g. Florida):</p>
<!-- ![](https://github.com/TrashBirdEcology/bbsAssistant/raw/master/images/regcred_select_trendests_byregion.png){width=300px}![](https://github.com/TrashBirdEcology/bbsAssistant/raw/master/images/regcred_select_fl.png){width=300px} -->
<!-- ![](https://github.com/TrashBirdEcology/bbsAssistant/raw/master/images/regcred_fl_ex.png){width=600px} -->
</div>
</div>
</div>
</div>
<div id="acknowledgments" class="section level1">
<h1 class="hasAnchor">
<a href="#acknowledgments" class="anchor"></a>Acknowledgments</h1>
<p>We thank the participatory scientists who collect data annually for the North American Breeding Bird Survey, and the Patuxent Wildlife Research Center for making these data publicly and easily accessible. Some functions in this package were adapted from the <a href="github.com/oharar/rbbs">rBBS</a> package and are mentioned in function source code as applicable.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#brief-overview-of-bbsassistant-functionality">Brief Overview of bbsAssistant Functionality</a><ul class="nav nav-pills nav-stacked">
<li><a href="#installing-package-and-loading-dependencies">Installing package and loading dependencies</a></li>
      <li><a href="#downloading-the-bbs-data-from-usgs-ftp">Downloading the BBS data from USGS FTP</a></li>
      <li><a href="#import-bbs-data-from-file-into-r">Import BBS data from file into R</a></li>
      <li><a href="#subsetting-the-bbs-count-data">Subsetting the BBS count data</a></li>
      <li><a href="#retrieve-bbs-analysis-results-and-data-credibility-measures">Retrieve BBS analysis results and data credibility measures</a></li>
      </ul>
</li>
      <li><a href="#acknowledgments">Acknowledgments</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jessica Burnett, Gabriela Palomo-Muñoz, Lyndsie Wszola.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
